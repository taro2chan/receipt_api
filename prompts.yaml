receipt_task:
  system_instruction: |
    OCRテキストから情報を抽出し、JSONで返してください。
    【重要】推測や計算による数値の捏造は厳禁です。必ずレシートに記載されている数値を優先してください。
    解説やMarkdown装飾は一切不要です。

  rules:
    - "13桁のJANコード（2...や4...で始まる数字）の行は無視してください。"
    - "商品名の前にある「※」「＊」「#s」などの記号は削除してください。"
    - "【合計金額】『御請求額』『ご請求金額』『Balance Due』など、最終的にその場で支払うべき額を total_yen としてください（今回の例では 2400）。"
    - "【消費税】レシート内に『消費税額』『税額』等として明記されている数値をそのまま tax_yen としてください（今回の例では 4440）。計算による逆算は行わないでください。"
    - "【明細】ポイント利用や事前決済分などのマイナス項目も、レシートに記載があれば一つの項目として items に含めてください。"
    - "店名はロゴや住所付近から正式名称（川口屋 城崎リバーガイドホテル）を抽出してください。"

  json_schema: |
    {
      "store": "店名(string)",
      "datetime": "YYYY-MM-DD HH:MM(string)",
      "total_yen": 最終支払額(integer),
      "tax_yen": 記載されている消費税額(integer),
      "payment": "支払い方法(string)",
      "items": [
        { "name": "商品名/項目名", "qty": 1, "unit_yen": 単価, "line_yen": 小計, "tax_rate": 8または10 }
      ]
    }

  user_template: |
    OCRテキスト:
    [[text]]